前提条件
========

## ハードウェア要件

### 推奨構成

    物理メモリ：2GB以上推奨
    空きディスク容量：512MB以上推奨
        データベースおよびリスト設定情報の領域はほとんど消費しませんが、
        投稿保管庫 (アーカイブ) は、保存メッセージ総量の3倍程度が見込まれます。

## ネットワーク要件

### ネットワークセキュリティ

・セキュリティグループ設定
 - インバウンド
   HTTP/HTTPS(80/443)
   SMTP(25)

 - アウトバウンド
   SMTP(25)


## SMTP制限

### AWSでのメール送信制限解除
https://aws.amazon.com/jp/premiumsupport/knowledge-center/ec2-port-25-throttle/

・この申請フォームで、制限解除するIPアドレスを指定する。

・それと同時に、そのIPアドレスの逆引きレコードの値を指定する。申請が受理されると逆引きが設定されます。

・申請なしでも少量のメールは出せます。

・Admin権限持ったユーザでないといけない…かも?

Elastic IPs information

実は必須

ここで書いた逆引きレコードを設定してくれる

## 必要なパラメータ

  * メールドメイン名

    <<説明未稿>>

  * リストシステム管理者のメールアドレス (複数可)

    <<説明未稿>>

  * ウェブサイトURLプリフィクス

    <<説明未稿>>

複数のメールドメイン名でSympaを運用する場合、メールドメイン名ごとにこれらのパラメータが必要です。
リストシステム管理者のメールアドレスについては同じものを設定することもできます。
ウェブサイトURLプリフィクスについては、そのメールドメインでウェブインタフェースを提供する場合に必要です。その際、異なるメールドメイン同士でのウェブサイトURLプリフィクスは重複してはなりません。

AMI設定手順
===========

### 1. イメージからのインスタンス起動

<<画像未採取>>

  1. 左ペインのイメージ＞AMIを選択します。
  2. 検索BOXのプルダウンから「パブリックイメージ」を選択し、検索するAMI名として「Sympa」を入力します。
  3. 【AMI de Sympa】を選択し、「アクション」で「起動」を選択します。
  4. <<以下未稿>>
      利用要件に合わせてインスタンスの作成およびセキュリティグループを設定してください。
  5.  作成したインスタンスが起動したら「Elastic IP」をインスタンスと関連付けします。
  
  
  

### 2. 初期設定

 2-1. インスタンスにSSHでアクセスします。

 2-2. ログインするとメニューが表示されます。

 ![図1](images/R001.png)

     「(Re)configure Sympa」を選択します。「1」を入力し、Enterキーを押します。
★途中でキャンセルしても次のスクリプトに進んでしまい、対話式インストール自体を止めることが出来ない。

      以後、Postfixの基本設定を行います。
     「OK」を選択して進みます。

 2-3. General type of mail configuration
 
![図2](images/R002.png)
  

     通常は「Internet Site」、「Internet with smarthost」のいずれかを選択します。

--------------------------------------------------------------------------------------------------

 2-4. System mail name

![図3](images/R003.png)

     Postfixが使用するメールドメイン名の初期値を設定します。
     これは「必要なパラメータ」で決めたメールドメイン名と同じでも、
     異なっていてもかまいません。
     
     【amidesympa.cvmxt.com】
     
--------------------------------------------------------------------------------------------------

 2-5. Root and postmaster mail recipient

![図4](images/R004.png)

     実在するメールアドレスを設定します。
     【test@example.jp】


--------------------------------------------------------------------------------------------------

 2-6. Other destinations to accept mail for

![図5](images/R005.png)

     特に設定すべきものがなければ、変更しなくてもかまいません。

--------------------------------------------------------------------------------------------------

 2-7. Force synchronous updates on mail queue?

![図6](images/R006.png)

     特に理由がないかぎり変更不要です。
     【No】

--------------------------------------------------------------------------------------------------

 2-8. Local networks

![図7](images/R007.png)

     メッセージの中継を受けるネットワークブロックを設定します。
     制限なく受け取る場合は【空欄】とします。
     初期値では、サーバ外からのメッセージを中継を受け付けません。
     
     【空欄】

--------------------------------------------------------------------------------------------------

 2-9.  Mailbox size limit (bytes)

![図8](images/R008.png)

     特に理由がないかぎり変更不要です。
     【0】(無制限)

--------------------------------------------------------------------------------------------------

 2-10. Local address extension character

![図9](images/R009.png)

     「+」のままにしておかなければなりません。
     【+】


--------------------------------------------------------------------------------------------------

 2-11. Internet protocols to use

![図10](images/R010.png)

     適切なものを選択します。
    【all】or 【ipv4】

--------------------------------------------------------------------------------------------------

  3. 続いてSympaの初期設定を行います。

 3-1. Sympa hostname

![図11](images/R011.png)

      Sympaのホスト名を入力します。
      【amidesympa.example.jp】

--------------------------------------------------------------------------------------------------

 3-2. Listmaster email address(es)

![図12](images/R012.png)

     Sympaメーリングリスト管理者のメールアドレスを入力します。
     【ono@conversion.co.jp】


--------------------------------------------------------------------------------------------------

 3-3. Reinstall database for sympa?

![図13](images/R013.png)
     
     【Yes】

--------------------------------------------------------------------------------------------------

 3-4. Database type to be used by sympa

 ![図14](images/DB001.png)

     使用するデータベースを選択します。「mysql」を推奨します。
     【mysql】

     以後、データベースの詳細設定と作成が行われます。

--------------------------------------------------------------------------------------------------
 3-5. Connection method for MySQL database of sympa

![図15](images/DB002.png)

      Unix socket
      TCP/IP
     【Unix Socket】

--------------------------------------------------------------------------------------------------

 3-6. MySQL database name for sympa

 ![図1](images/DB003.png)
     

     【sympa】

--------------------------------------------------------------------------------------------------

 3-7. MySQL username for sympa

![図16](images/DB004.png)

     
     【sympa@localhost】
     

--------------------------------------------------------------------------------------------------

 3-8. MySQL application password for sympa

![図17](images/DB005.png)
     
     任意のパスワードを設定してください
     【●●●●●】

--------------------------------------------------------------------------------------------------

 3-9. Password confirmation

![図18](images/DB006.png)
     
     前項で設定したパスワードを再入力します。
     【●●●●●】


--------------------------------------------------------------------------------------------------

 3-10. Name of the database's administrative user

![図19](images/DB007.png)

     
     rootのままでOKです。
     【root】

--------------------------------------------------------------------------------------------------

 3-11. URL to access WWSympa

![図20](images/R004.png)

     
     【http://amidesympa.example.jp/wws】

--------------------------------------------------------------------------------------------------

 3-12. Which Web Server(s) are you running?

![図21](images/R005.png)
     
      Apache2
      Other
      【Apache2】

--------------------------------------------------------------------------------------------------

 3-13. Do you want the sympa SOAP server to be used?

![図22](images/R006.png)

     
     【No】

--------------------------------------------------------------------------------------------------

 3-14. Should sympanewaliases-wrapper be setuid root?

![図23](images/R007.png)


     「Yes」を選択します。
     ※このオプションは将来廃止予定ですが、現状では「Yes」を選択しないと正しく動作しません。
     【Yes】


--------------------------------------------------------------------------------------------------

 3-15. Should the web archives and the bounce directory be removed?

![図24](images/R008.png)
     
     【No】

--------------------------------------------------------------------------------------------------

  ★. 初期設定が完了するとメニューに戻ります。


--------------------------------------------------------------------------------------------------

  4. 続いてSympaのWeb管理画面から操作を行います。

 4-1. Webブラウザから「手順2-5」で設定したURLにアクセスします。

![図25](images/GUI001.png)

     
     【http://amidesympa.example.jp/wws】
     
     ようこそ画面が表示されることを確認します。

--------------------------------------------------------------------------------------------------

 4-2. 右上のログインボタンをクリックし、ログイン画面に遷移します。

![図26](images/GUI002.png)
     
     画面下の【まだログインしたことがない】を選択します。
     

--------------------------------------------------------------------------------------------------

 4-3. あなたのメールアドレス

![図27](images/GUI003.png)

     「![図12](images/R012.png)」で入力したメーリングリスト管理者のメールアドレスを入力し、
     「初期パスワードの取り寄せ」ボタンをクリックします。


--------------------------------------------------------------------------------------------------

 4-4. メーリングリスト管理者宛てに初期パスワードが届きます。

![図28](images/GUI004.png)

     ※画像はサンプルです。
     
     URLをクリックしてパスワード設定画面に遷移します。

--------------------------------------------------------------------------------------------------

 4-5. メーリングリスト管理者のパスワードを設定します。

![図29](images/GUI005.png)


--------------------------------------------------------------------------------------------------
XXXXX一旦ここまでXXXXX


### メールドメインの追加

メーリングリストサービスで使用するメールドメインの設定を行います。

複数のメールドメインを使う場合、本節の手順をメールドメイン毎に繰り返します。

  1. 「2」をタイプし、Enterキーを押します。

     ![図1](005.png)

     次のものを入力します。

       * メールドメイン名。
       * リストシステム管理者のメールアドレス。
       * ウェブインタフェースのURLプリフィクス (あれば)。

     入力を確認し、「y」をタイプしてEnterを押します。

### その他の操作

  * 詳細な設定変更については、メニューで「9」を選択してシェルを起動します。

  * 接続を切断するには、メニューで「0」を選択します。

